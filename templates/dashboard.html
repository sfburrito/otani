{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <div class="preferences-panel" data-aos="fade-up">
        <div class="section-header">
            <div class="header-title">
                <h3>Investment Preferences</h3>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" onclick="resetPreferences()">Reset</button>
                <button class="btn btn-primary" onclick="savePreferences()">Save Preferences</button>
            </div>
        </div>
        
        <div class="preferences-grid">
            <div class="custom-select-container">
                <label class="preference-label">Investment Stage</label>
                <div class="custom-select" tabindex="0" data-placeholder="Select stages">
                    <div class="select-trigger">
                        <span class="selected-text">Select stages</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="custom-options">
                        <label class="option-item">
                            <input type="checkbox" value="seed"> Seed
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="series_a"> Series A
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="series_b"> Series B
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="series_c"> Series C+
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="growth"> Growth
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="late_stage"> Late Stage
                        </label>
                    </div>
                </div>
            </div>

            <div class="custom-select-container">
                <label class="preference-label">Industry Sectors</label>
                <div class="custom-select" tabindex="0" data-placeholder="Select industries">
                    <div class="select-trigger">
                        <span class="selected-text">Select industries</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="custom-options">
                        <label class="option-item">
                            <input type="checkbox" value="ai_ml"> AI/Machine Learning
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="fintech"> Fintech
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="healthcare"> Healthcare/Biotech
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="saas"> Enterprise SaaS
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="consumer"> Consumer Tech
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="cleantech"> Cleantech/Sustainability
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="cybersecurity"> Cybersecurity
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="ecommerce"> E-commerce
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="edtech"> EdTech
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="gaming"> Gaming
                        </label>
                    </div>
                </div>
            </div>

            <div class="custom-select-container">
                <label class="preference-label">Geographic Focus</label>
                <div class="custom-select" tabindex="0" data-placeholder="Select regions">
                    <div class="select-trigger">
                        <span class="selected-text">Select regions</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="custom-options">
                        <label class="option-item">
                            <input type="checkbox" value="north_america"> North America
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="europe"> Europe
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="asia_pacific"> Asia-Pacific
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="latam"> Latin America
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="mea"> Middle East and Africa
                        </label>
                    </div>
                </div>
            </div>

            <div class="custom-select-container">
                <label class="preference-label">Investment Size</label>
                <div class="custom-select" tabindex="0" data-placeholder="Select investment sizes">
                    <div class="select-trigger">
                        <span class="selected-text">Select investment sizes</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="custom-options">
                        <label class="option-item">
                            <input type="checkbox" value="under_1m"> < $1M
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="1m_5m"> $1M - $5M
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="5m_20m"> $5M - $20M
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="20m_50m"> $20M - $50M
                        </label>
                        <label class="option-item">
                            <input type="checkbox" value="over_50m"> $50M+
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="additional-preferences">
            <label class="preference-label" for="additionalPrefs">Additional Preferences</label>
            <textarea 
                id="additionalPrefs" 
                class="preference-textarea" 
                placeholder="Enter any additional preferences, criteria, or notes not covered above (e.g., specific technologies, founder backgrounds, impact goals). This information will help us better understand your unique investment strategy."
                rows="4"
            ></textarea>
        </div>
    </div>

    <div class="section-header">
        <div class="header-title">
            <h3>Your Companies</h3>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openModal()">
                <i class="fas fa-plus"></i> Add Company
            </button>
        </div>
    </div>

    <div class="company-list">
        {% for company in companies %}
        <div class="company-row" data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
            <div class="company-main">
                <div class="company-title">
                    <h3 class="company-name">{{ company.name }}</h3>
                    <span class="company-stage">{{ company.stage }}</span>
                </div>
                <div class="company-industry">{{ company.industry }}</div>
                <p class="company-description">{{ company.description }}</p>
            </div>
            <div class="company-actions">
                {% if company.website %}
                <a href="{{ company.website }}" class="company-link" target="_blank">
                    <i class="fas fa-globe"></i> Website
                </a>
                {% endif %}
                {% if company.contact_email %}
                <a href="mailto:{{ company.contact_email }}" class="company-link">
                    <i class="fas fa-envelope"></i> Contact
                </a>
                {% endif %}
                <div class="company-date">
                    <i class="fas fa-calendar"></i> {{ company.created_at.strftime('%Y-%m-%d') }}
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-state" data-aos="fade-up">
            <i class="fas fa-folder-open"></i>
            <h3>No Companies Yet</h3>
            <p>Start building your portfolio by adding your first company.</p>
            <button class="btn btn-primary mt-4" onclick="openModal()">
                <i class="fas fa-plus"></i> Add Your First Company
            </button>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Add Company Modal -->
<div id="addCompanyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Company</h3>
            <button type="button" class="close-modal" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form class="add-company-form" method="POST" action="{{ url_for('add_company') }}">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" for="name">Company Name</label>
                    <input type="text" class="form-input" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="industry">Industry</label>
                    <input type="text" class="form-input" id="industry" name="industry">
                </div>
                <div class="form-group">
                    <label class="form-label" for="stage">Stage</label>
                    <select class="form-input" id="stage" name="stage">
                        <option value="Seed">Seed</option>
                        <option value="Series A">Series A</option>
                        <option value="Series B">Series B</option>
                        <option value="Series C">Series C+</option>
                        <option value="Growth">Growth</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="website">Website</label>
                    <input type="url" class="form-input" id="website" name="website">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="description">Description</label>
                <textarea class="form-input" id="description" name="description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="contact_email">Contact Email</label>
                <input type="email" class="form-input" id="contact_email" name="contact_email">
            </div>
            <div class="form-group">
                <label class="form-label" for="notes">Notes</label>
                <textarea class="form-input" id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Company</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize custom dropdowns
    const customSelects = document.querySelectorAll('.custom-select');
    
    customSelects.forEach(select => {
        const trigger = select.querySelector('.select-trigger');
        const selectedText = select.querySelector('.selected-text');
        const options = select.querySelectorAll('.option-item input');
        const placeholder = select.dataset.placeholder;
        
        // Handle click outside
        document.addEventListener('click', (e) => {
            if (!select.contains(e.target)) {
                select.classList.remove('open');
            }
        });
        
        // Toggle dropdown
        trigger.addEventListener('click', (e) => {
            e.stopPropagation();
            const isOpen = select.classList.contains('open');
            
            // Close all other dropdowns
            customSelects.forEach(s => s.classList.remove('open'));
            
            // Toggle current dropdown
            select.classList.toggle('open', !isOpen);
        });
        
        // Handle option selection
        options.forEach(option => {
            option.addEventListener('change', () => {
                const selectedOptions = Array.from(options)
                    .filter(opt => opt.checked)
                    .map(opt => opt.parentElement.textContent.trim());
                
                if (selectedOptions.length > 0) {
                    selectedText.textContent = selectedOptions.join(', ');
                } else {
                    selectedText.textContent = placeholder;
                }
            });
        });
        
        // Handle keyboard navigation
        select.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                select.classList.toggle('open');
            } else if (e.key === 'Escape') {
                select.classList.remove('open');
            }
        });
    });

    // Initialize auto-expanding textarea
    const textarea = document.getElementById('additionalPrefs');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
    
    // Initialize AOS
    AOS.init({
        duration: 800,
        once: true
    });
});

function savePreferences() {
    const preferences = {
        categories: {},
        additional: document.getElementById('additionalPrefs').value
    };

    document.querySelectorAll('.custom-select').forEach(select => {
        const category = select.closest('.custom-select-container').querySelector('.preference-label').textContent;
        const selectedOptions = Array.from(select.querySelectorAll('input:checked'))
            .map(input => input.value);
        preferences.categories[category] = selectedOptions;
    });
    
    console.log('Saved preferences:', preferences);
    
    const toast = document.createElement('div');
    toast.className = 'toast success';
    toast.textContent = 'Preferences saved successfully';
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

function resetPreferences() {
    document.querySelectorAll('.custom-select').forEach(select => {
        const selectedText = select.querySelector('.selected-text');
        const options = select.querySelectorAll('input');
        
        options.forEach(option => option.checked = false);
        selectedText.textContent = select.dataset.placeholder;
    });

    const textarea = document.getElementById('additionalPrefs');
    textarea.value = '';
    textarea.style.height = 'auto';
}

function openModal() {
    document.getElementById('addCompanyModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('addCompanyModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        closeModal();
    }
}
</script>
{% endblock %}
