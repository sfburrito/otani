{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <div class="preferences-panel" data-aos="fade-up">
        <div class="preferences-header">
            <h3>Investment Preferences</h3>
            <button class="btn-icon" onclick="togglePreferences()" id="togglePrefs">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        
        <div class="preferences-grid" id="preferencesGrid">
            <div class="preference-group">
                <label class="preference-label">Investment Stage</label>
                <select class="form-select" multiple data-placeholder="Select stages">
                    <option value="seed">Seed</option>
                    <option value="series_a">Series A</option>
                    <option value="series_b">Series B</option>
                    <option value="series_c">Series C+</option>
                    <option value="growth">Growth</option>
                    <option value="late_stage">Late Stage</option>
                </select>
            </div>

            <div class="preference-group">
                <label class="preference-label">Industry Sectors</label>
                <select class="form-select" multiple data-placeholder="Select industries">
                    <option value="ai_ml">AI/Machine Learning</option>
                    <option value="fintech">Fintech</option>
                    <option value="healthcare">Healthcare/Biotech</option>
                    <option value="saas">Enterprise SaaS</option>
                    <option value="consumer">Consumer Tech</option>
                    <option value="cleantech">Cleantech/Sustainability</option>
                    <option value="cybersecurity">Cybersecurity</option>
                    <option value="ecommerce">E-commerce</option>
                    <option value="edtech">EdTech</option>
                    <option value="gaming">Gaming</option>
                </select>
            </div>

            <div class="preference-group">
                <label class="preference-label">Geographic Focus</label>
                <select class="form-select" multiple data-placeholder="Select regions">
                    <option value="north_america">North America</option>
                    <option value="europe">Europe</option>
                    <option value="asia_pacific">Asia-Pacific</option>
                    <option value="latam">Latin America</option>
                    <option value="mea">Middle East and Africa</option>
                </select>
            </div>

            <div class="preference-group">
                <label class="preference-label">Investment Size</label>
                <select class="form-select" multiple data-placeholder="Select investment sizes">
                    <option value="under_1m">< $1M</option>
                    <option value="1m_5m">$1M - $5M</option>
                    <option value="5m_20m">$5M - $20M</option>
                    <option value="20m_50m">$20M - $50M</option>
                    <option value="over_50m">$50M+</option>
                </select>
            </div>
        </div>

        <div class="preferences-footer">
            <button class="btn btn-outline" onclick="resetPreferences()">Reset</button>
            <button class="btn btn-primary" onclick="savePreferences()">Save Preferences</button>
        </div>
    </div>

    <div class="dashboard-header">
        <h2>Your Portfolio</h2>
        <button class="btn btn-primary" onclick="openModal()">
            <i class="fas fa-plus"></i> Add Company
        </button>
    </div>

    <div class="company-list">
        {% for company in companies %}
        <div class="company-row" data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
            <div class="company-main">
                <div class="company-title">
                    <h3 class="company-name">{{ company.name }}</h3>
                    <span class="company-stage">{{ company.stage }}</span>
                </div>
                <div class="company-industry">{{ company.industry }}</div>
                <p class="company-description">{{ company.description }}</p>
            </div>
            <div class="company-actions">
                {% if company.website %}
                <a href="{{ company.website }}" class="company-link" target="_blank">
                    <i class="fas fa-globe"></i> Website
                </a>
                {% endif %}
                {% if company.contact_email %}
                <a href="mailto:{{ company.contact_email }}" class="company-link">
                    <i class="fas fa-envelope"></i> Contact
                </a>
                {% endif %}
                <div class="company-date">
                    <i class="fas fa-calendar"></i> {{ company.created_at.strftime('%Y-%m-%d') }}
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-state" data-aos="fade-up">
            <i class="fas fa-folder-open"></i>
            <h3>No Companies Yet</h3>
            <p>Start building your portfolio by adding your first company.</p>
            <button class="btn btn-primary mt-4" onclick="openModal()">
                <i class="fas fa-plus"></i> Add Your First Company
            </button>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Add Company Modal -->
<div id="addCompanyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Company</h3>
            <button type="button" class="close-modal" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form class="add-company-form" method="POST" action="{{ url_for('add_company') }}">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label" for="name">Company Name</label>
                    <input type="text" class="form-input" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="industry">Industry</label>
                    <input type="text" class="form-input" id="industry" name="industry">
                </div>
                <div class="form-group">
                    <label class="form-label" for="stage">Stage</label>
                    <select class="form-input" id="stage" name="stage">
                        <option value="Seed">Seed</option>
                        <option value="Series A">Series A</option>
                        <option value="Series B">Series B</option>
                        <option value="Series C">Series C+</option>
                        <option value="Growth">Growth</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="website">Website</label>
                    <input type="url" class="form-input" id="website" name="website">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="description">Description</label>
                <textarea class="form-input" id="description" name="description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="contact_email">Contact Email</label>
                <input type="email" class="form-input" id="contact_email" name="contact_email">
            </div>
            <div class="form-group">
                <label class="form-label" for="notes">Notes</label>
                <textarea class="form-input" id="notes" name="notes" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Company</button>
            </div>
        </form>
    </div>
</div>

<script>
function openModal() {
    document.getElementById('addCompanyModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('addCompanyModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

document.addEventListener('DOMContentLoaded', function() {
    // Modal handling
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            closeModal();
        }
    }

    // Initialize Select2
    $('.form-select').select2({
        theme: 'custom',
        closeOnSelect: false,
        allowClear: true,
        width: '100%'
    });

    // Initialize AOS
    AOS.init({
        duration: 800,
        once: true
    });
});

function togglePreferences() {
    const grid = document.getElementById('preferencesGrid');
    const btn = document.getElementById('togglePrefs');
    const icon = btn.querySelector('i');
    
    if (grid.style.display === 'none') {
        grid.style.display = 'grid';
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
    } else {
        grid.style.display = 'none';
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
    }
}

function savePreferences() {
    const toast = document.createElement('div');
    toast.className = 'toast success';
    toast.textContent = 'Preferences saved successfully';
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

function resetPreferences() {
    $('.form-select').val(null).trigger('change');
}
</script>
{% endblock %}
